"use strict";(globalThis.webpackChunkwave_lang=globalThis.webpackChunkwave_lang||[]).push([[142],{2084(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"syntax/ffi","title":"FFI","description":"This document describes the FFI (Foreign Function Interface) specification for calling functions implemented externally in the Wave language.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/syntax/ffi.md","sourceDirName":"syntax","slug":"/syntax/ffi","permalink":"/docs/syntax/ffi","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"\uc5f4\uac70\ud615 (enum)\uacfc \ud0c0\uc785 \ubcc4\uce6d (type alias)","permalink":"/docs/syntax/enumandtype"},"next":{"title":"Wave Ecosystem","permalink":"/docs/ecosystem/"}}');var l=i(4848),a=i(8453);const r={sidebar_position:9},s="FFI",c={},o=[{value:"Overview",id:"overview",level:2},{value:"extern Declaration",id:"extern-declaration",level:2},{value:"ABI Specification",id:"abi-specification",level:2},{value:"Function-level extern declaration",id:"function-level-extern-declaration",level:2},{value:"Block-level extern declaration",id:"block-level-extern-declaration",level:2},{value:"Symbol naming",id:"symbol-naming",level:2},{value:"Function-level symbol specification",id:"function-level-symbol-specification",level:3},{value:"Block-level symbol specification",id:"block-level-symbol-specification",level:3},{value:"Pointer Type",id:"pointer-type",level:2},{value:"Struct Usage",id:"struct-usage",level:2},{value:"External Function Call",id:"external-function-call",level:2},{value:"Linking",id:"linking",level:2},{value:"Limitations",id:"limitations",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"ffi",children:"FFI"})}),"\n",(0,l.jsx)(n.p,{children:"This document describes the FFI (Foreign Function Interface) specification for calling functions implemented externally in the Wave language.\nThrough FFI, Wave programs can directly interface with native libraries written in other languages."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsx)(n.p,{children:"Wave's FFI works on a declaration basis.\nExternal functions are not implemented in Wave code, and only specify which ABI (Application Binary Interface) they adhere to.\nThe actual implementation is resolved from an external library at the linking stage."}),"\n",(0,l.jsx)(n.p,{children:"FFI operates by declaring only the existence of functions at compile time, and the linker connects the actual symbols when creating the executable."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"extern-declaration",children:"extern Declaration"}),"\n",(0,l.jsx)(n.p,{children:"External functions are declared using the extern keyword.\nAll external function declarations require ABI specification."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:"extern(abi) fun functionName(arguments...) -> returnType;\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"abi-specification",children:"ABI Specification"}),"\n",(0,l.jsxs)(n.p,{children:["ABI must be specified in an ",(0,l.jsx)(n.code,{children:"extern"})," declaration.\nABI indicates which calling convention and symbol rules an external function follows."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:"extern(c) fun printf(fmt: ptr<u8>);\nextern(rust) fun rust_func(i32);\n"})}),"\n",(0,l.jsx)(n.p,{children:"ABI is treated as an identifier, and no specific ABI is provided as a default at the language level.\nAll external functions must explicitly specify an ABI."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"function-level-extern-declaration",children:"Function-level extern declaration"}),"\n",(0,l.jsx)(n.p,{children:"To declare a single external function, write as follows."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:"extern(c) fun InitWindow(width: i32, height: i32, title: ptr<u8>);\n"})}),"\n",(0,l.jsxs)(n.p,{children:["This declaration means that the ",(0,l.jsx)(n.code,{children:"InitWindow"})," symbol following the C ABI exists in an external library."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"block-level-extern-declaration",children:"Block-level extern declaration"}),"\n",(0,l.jsx)(n.p,{children:"If there are multiple external functions using the same ABI, they can be declared together in a block form."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:"extern(c) {\n    fun InitWindow(width: i32, height: i32, title: ptr<u8>);\n    fun CloseWindow();\n    fun BeginDrawing();\n    fun EndDrawing();\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"Block-level declarations are semantically identical to function-level declarations, serving merely as syntax for readability and structuring."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"symbol-naming",children:"Symbol naming"}),"\n",(0,l.jsx)(n.p,{children:"In some ABIs, the function name in Wave might not match the actual linker symbol name.\nIn this case, you can specify the actual symbol name to be linked for an external function in a string."}),"\n",(0,l.jsx)(n.h3,{id:"function-level-symbol-specification",children:"Function-level symbol specification"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:'extern(rust, "_ZN4test10rust_func117h123abcE")\nfun rust_func(i32);\n'})}),"\n",(0,l.jsxs)(n.p,{children:["This declaration specifies that the ",(0,l.jsx)(n.code,{children:"_ZN4test10rust_func117h123abcE"})," symbol should be used when calling ",(0,l.jsx)(n.code,{children:"rust_func"}),"."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"block-level-symbol-specification",children:"Block-level symbol specification"}),"\n",(0,l.jsx)(n.p,{children:"In block-level declarations, symbol names can be individually specified after each function."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:'extern(rust) {\n    fun rust_func1(i32) "_ZN4test10rust_func117h123abcE";\n    fun rust_func2(i32) "_ZN4test10rust_func217h456defE";\n}\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"pointer-type",children:"Pointer Type"}),"\n",(0,l.jsxs)(n.p,{children:["Pointers are represented in the form ",(0,l.jsx)(n.code,{children:"ptr<T>"}),"."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:"ptr<u8>\nptr<MyStruct>\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ptr<T>"})," directly corresponds to pointers in external languages, and memory ownership or lifecycle is not managed by Wave."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"struct-usage",children:"Struct Usage"}),"\n",(0,l.jsx)(n.p,{children:"Structs can be used as arguments or return values of external functions."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:"struct Color {\n    r: u8,\n    g: u8,\n    b: u8,\n    a: u8,\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"When using structs in FFI, the field order is preserved as declared, following the memory layout required by the ABI."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"external-function-call",children:"External Function Call"}),"\n",(0,l.jsxs)(n.p,{children:["Functions declared as ",(0,l.jsx)(n.code,{children:"extern"})," are called in the same manner as regular functions."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-wave",children:'fun main() -> i32 {\n    InitWindow(800, 600, "Wave");\n    BeginDrawing();\n    EndDrawing();\n    CloseWindow();\n    return 0;\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"There is no syntactical difference in calls, and calling conventions and symbol linking are entirely handled by the ABI and linker."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"linking",children:"Linking"}),"\n",(0,l.jsx)(n.p,{children:"The actual implementation of external functions is provided by external libraries at the linking stage.\nThe Wave compiler generates object files including external function calls, and the linker resolves symbols through the specified libraries."}),"\n",(0,l.jsx)(n.p,{children:"The method of specifying libraries is done through build tools and CLI options."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,l.jsx)(n.p,{children:"Wave does not provide the following features."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Function Pointers"}),"\n",(0,l.jsx)(n.li,{children:"Callback Functions"}),"\n",(0,l.jsx)(n.li,{children:"Automatic Memory Management"}),"\n",(0,l.jsx)(n.li,{children:"Inter-language Exception Handling Integration"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"These features may be addressed separately in future versions."})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>r,x:()=>s});var t=i(6540);const l={},a=t.createContext(l);function r(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);