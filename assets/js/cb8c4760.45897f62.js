"use strict";(globalThis.webpackChunkwave_lang=globalThis.webpackChunkwave_lang||[]).push([[466],{8291(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"syntax/inline_asm","title":"Inline Assembly","description":"Introduction","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/syntax/inline_asm.md","sourceDirName":"syntax","slug":"/syntax/inline_asm","permalink":"/docs/syntax/inline_asm","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Pointer","permalink":"/docs/syntax/pointer"},"next":{"title":"Struct","permalink":"/docs/syntax/struct"}}');var i=t(4848),a=t(8453);const r={sidebar_position:7},o="Inline Assembly",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Basic Syntax",id:"basic-syntax",level:2},{value:"Simple Example",id:"simple-example",level:2},{value:"Precautions",id:"precautions",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"inline-assembly",children:"Inline Assembly"})}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"This document describes the inline assembly feature provided by the Wave language.\nInline assembly is one of the features provided by Wave. It is a syntax designed to directly access low-level hardware control while maintaining the convenience and structure of high-level languages."}),"\n",(0,i.jsx)(n.p,{children:"It enables tasks such as register manipulation, memory address unit access, and execution of specific CPU instructions that are difficult to express with general Wave code. It is used when performance optimization or hardware and architecture-dependent code is required.\nThrough this feature, Wave can encompass system programming areas beyond just being a high-level language."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"basic-syntax",children:"Basic Syntax"}),"\n",(0,i.jsxs)(n.p,{children:["Inline assembly is written with ",(0,i.jsx)(n.code,{children:"asm { ... } "})," block.\nWithin this block, the assembly instructions that will be executed and the input/output mappings to connect Wave variables with CPU registers are defined."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-wave",children:'asm {\n    "assembly command"          // actual assembly code (one command per line)\n    ...\n    in("register") value         // input register mapping\n    out("register") variable      // output register mapping\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"The assembly instructions are written in string form, detailing the low-level commands executed on the actual CPU.\nIt can be written in multiple lines, with the principle of writing only one command per line."}),"\n",(0,i.jsx)(n.p,{children:"For example, it can be used in the following form."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-wave",children:'"mov rax, 1"\n"syscall"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:'in("register")'})," value syntax is used to load the value of a Wave variable or expression into the specified CPU register.\nThrough this, the register can be used as an input value in assembly code."]}),"\n",(0,i.jsx)(n.p,{children:"The example below shows the case of transferring the value of variable s to rdi, the first syscall argument register in the x86-64 convention."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-wave",children:'in("rdi") s\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Conversely, the ",(0,i.jsx)(n.code,{children:'out("register")'})," variable syntax is used to bring the value in the specified register into a Wave variable.\nThis method is used when the result of the assembly execution needs to be used in Wave code."]}),"\n",(0,i.jsxs)(n.p,{children:["The following example shows the case of storing the value of the ",(0,i.jsx)(n.code,{children:"rax"})," register, where the return value of the ",(0,i.jsx)(n.code,{children:"syscall"})," is stored, into the variable ",(0,i.jsx)(n.code,{children:"ret"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-wave",children:'out("rax") ret\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"simple-example",children:"Simple Example"}),"\n",(0,i.jsxs)(n.p,{children:["The example below is a simple code that prints a string to standard output using ",(0,i.jsx)(n.code,{children:"syscall"})," in a Linux x86-64 environment."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-wave",children:'fun main() {\n    var msg_ptr: ptr<I8> = "Hello from syscall!\\n";\n    var ret_val: i64;\n\n    asm {\n        "mov rax, 1"\n        "syscall"\n        in("rdi") 1\n        in("rsi") msg_ptr\n        in("rdx") 20\n        out("rax") ret_val\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, Wave code directly sets the pointer and length of the string to the register and calls the system call to perform the output operation.\nThe return value of the system call is delivered via the ",(0,i.jsx)(n.code,{children:"rax"})," register and is brought back into a Wave variable through the ",(0,i.jsx)(n.code,{children:"out"})," syntax."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"precautions",children:"Precautions"}),"\n",(0,i.jsx)(n.p,{children:"Inline assembly is a feature that intentionally circumvents Wave's type safety and abstraction.\nIf incorrect commands are used or register setting errors occur, the program may terminate abnormally or undefined behavior may occur."}),"\n",(0,i.jsxs)(n.p,{children:["The mapping of registers through ",(0,i.jsx)(n.code,{children:"in"})," and ",(0,i.jsx)(n.code,{children:"out"})," is verified at compile time, but the semantic validity or execution results of assembly instructions are not guaranteed.\nTherefore, when using inline assembly, you must accurately understand the target architecture, calling conventions, and the behavior of the instructions."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>o});var s=t(6540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);